<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dev.basic.mapper.QuartzMapper">

    <select id="page" resultType="org.dev.basic.entity.QuartzJob">
        SELECT
        *
        FROM
        (
        SELECT
        job.JOB_NAME AS jobName,
        job.JOB_GROUP AS jobGroup,
        job.DESCRIPTION AS description,
        job.JOB_CLASS_NAME AS jobClassName,
        cron.CRON_EXPRESSION AS cronExpression,
        tri.TRIGGER_NAME AS triggerName,
        tri.TRIGGER_STATE AS triggerState,
        job.JOB_NAME AS oldJobName,
        job.JOB_GROUP AS oldJobGroup,
        tri.TRIGGER_TYPE AS jobType
        FROM
        qrtz_job_details AS job
        LEFT JOIN qrtz_triggers AS tri ON job.JOB_NAME = tri.JOB_NAME
        LEFT JOIN qrtz_cron_triggers AS cron ON cron.TRIGGER_NAME = tri.TRIGGER_NAME
        WHERE
        tri.TRIGGER_TYPE = 'CRON'
        UNION ALL
        SELECT
        job.JOB_NAME AS jobName,
        job.JOB_GROUP AS jobGroup,
        job.DESCRIPTION AS description,
        job.JOB_CLASS_NAME AS jobClassName,
        cron.repeat_interval AS cronExpression,
        tri.TRIGGER_NAME AS triggerName,
        tri.TRIGGER_STATE AS triggerState,
        job.JOB_NAME AS oldJobName,
        job.JOB_GROUP AS oldJobGroup,
        tri.TRIGGER_TYPE AS jobType
        FROM
        qrtz_job_details AS job
        LEFT JOIN qrtz_triggers AS tri ON job.JOB_NAME = tri.JOB_NAME
        LEFT JOIN qrtz_simple_triggers AS cron ON cron.TRIGGER_NAME = tri.TRIGGER_NAME
        WHERE
        tri.TRIGGER_TYPE = 'SIMPLE'
        ) TEMP
        <where>
            1=1
            <if test="jobName != null and jobName != '' ">
                AND TEMP.jobName = #{jobName}
            </if>
            <if test="jobType != null and jobType != '' ">
                AND TEMP.jobType = #{jobType}
            </if>
        </where>
    </select>
</mapper>